<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Members Heatmap</title>
    <style>
        #map {
            width: 90vw;
            height: 90vh;
        }
        #info {
            margin-top: 20px;
            padding: 10px;
            border: 1px solid #ccc;
            display: none;
        }
        #info h3 {
            margin: 0 0 10px 0;
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.3.2/dist/echarts.min.js"></script>
</head>
<body>
    <h1>成员地图</h1>
    <div id="map"></div>
    <div id="info">
        <h3>省份：<span id="province"></span></h3>
        <ul id="memberList"></ul>
    </div>

    <script>
        var mapChart = echarts.init(document.getElementById('map'));
        var memberData = [];
        var provinceMemberCount = {};

        Promise.all([
            fetch('map.json').then(response => response.json()),
            fetch('member.json').then(response => response.json())
        ]).then(([geoJson, data]) => {
            console.log('Loaded GeoJSON data:', geoJson);
            echarts.registerMap('china', geoJson);
            console.log('China map registered successfully');

            memberData = data;
            console.log('Loaded member data:', memberData);

            data.forEach(member => {
                if (provinceMemberCount[member.province]) {
                    provinceMemberCount[member.province]++;
                } else {
                    provinceMemberCount[member.province] = 1;
                }
            });
            console.log('Province member count:', provinceMemberCount);

            var option = {
                tooltip: {
                    trigger: 'item',
                    formatter: function (params) {
                        var province = params.name;
                        var count = provinceMemberCount[province] || 0;
                        return province + ': ' + count + ' 名成员';
                    }
                },
                visualMap: {
                    min: 0,
                    max: 5, // 调整为实际成员数量的最大值
                    left: 'left',
                    top: 'bottom',
                    text: ['多', '少'],
                    calculable: true,
                    inRange: {
                        color: ['#e0ffff', '#006edd']
                    }
                },
                series: [{
                    type: 'map',
                    map: 'china',
                    label: {
                        show: true
                    },
                    data: Object.keys(provinceMemberCount).map(province => ({
                        name: province,
                        value: provinceMemberCount[province]
                    }))
                }]
            };

            console.log('Map option:', option);
            mapChart.setOption(option);

            mapChart.on('click', function (params) {
                var province = params.name;
                var membersInProvince = memberData.filter(member => member.province === province);

                if (membersInProvince.length > 0) {
                    document.getElementById('province').innerText = province;
                    var memberList = document.getElementById('memberList');
                    memberList.innerHTML = '';

                    membersInProvince.forEach(member => {
                        var listItem = document.createElement('li');
                        listItem.innerHTML = `<strong>${member.name}</strong> - ${member.status}, Email: ${member.email}`;
                        memberList.appendChild(listItem);
                    });

                    document.getElementById('info').style.display = 'block';
                } else {
                    document.getElementById('info').style.display = 'none';
                }
            });
        }).catch(error => {
            console.error('Error loading or processing data:', error);
            alert('加载地图时发生错误。请查看控制台以获取更多详细信息。');
        });
    </script>
</body>
</html>
